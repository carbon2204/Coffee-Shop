{% extends "base.html" %}
{% block title %}Админпанель{% endblock %}
{% block content %}
<h2>Админпанель</h2>

<!-- Ссылка на добавление товара -->
<div class="section-block">
  <a href="{{ url_for('add_product_admin') }}" class="btn">Добавить товар</a>
</div>

<!-- Ссылка на добавление записи в блог -->
<div class="section-block">
  <a href="{{ url_for('add_blog_post_admin') }}" class="btn">Добавить статью в блог</a>
</div>

<!-- Ссылка на контроль заказов -->
<div class="section-block" style="margin-top: 2em;">
  <a href="{{ url_for('admin_orders') }}" class="btn">Контроль заказов</a>
</div>

<!-- Ссылка на контроль ПО -->
<div class="section-block">
  <a href="{{ url_for('admin_integrity') }}" class="btn">Контроль ПО</a>
</div>

<!-- Список товаров -->
<div class="section-block" style="margin-top: 2em;">
  <h3>Список товаров</h3>
  <table border="1" cellspacing="0" cellpadding="8">
    <thead>
      <tr>
        <th>Название</th>
        <th>Цена</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.price }} руб.</td>
        <td>
          <!-- Кнопка/ссылка для редактирования -->
          <a href="{{ url_for('edit_product', product_id=product.id) }}"
             style="display:inline-block; margin-right:8px;">
            Редактировать
          </a>
          <!-- Удаление (форма) -->
          <form action="{{ url_for('delete_product', product_id=product.id) }}"
                method="POST"
                style="display:inline-block; margin:0; padding:0;"
                onsubmit="return confirm('Удалить товар {{ product.name }}?');">
            <button type="submit">Удалить</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Список пользователей -->
<div class="section-block" style="margin-top: 2em;">
  <h3>Список пользователей</h3>
  <table border="1" cellspacing="0" cellpadding="8">
    <thead>
      <tr>
        <th>Имя пользователя</th>
        <th>Админ?</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ u.username }}</td>
        <td>{{ 'Да' if u.is_admin else 'Нет' }}</td>
        <td>
          {% if u.id != current_user.id %}
          <form action="{{ url_for('delete_user', user_id=u.id) }}"
                method="POST"
                style="display:inline-block;"
                onsubmit="return confirm('Удалить пользователя {{ u.username }}?');">
            <button type="submit">Удалить</button>
          </form>
          {% else %}
          <em>Вы</em>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Список постов блога -->
<div class="section-block" style="margin-top: 2em;">
  <h3>Список статей блога</h3>
  <table border="1" cellspacing="0" cellpadding="8">
    <thead>
      <tr>
        <th>Заголовок</th>
        <th>Дата</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for post in posts %}
      <tr>
        <td>{{ post.title }}</td>
        <td>{{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>
          <!-- Редактирование поста -->
          <a href="{{ url_for('edit_blog_post_admin', post_id=post.id) }}"
             style="display:inline-block; margin-right:8px;">
            Редактировать
          </a>
          <!-- Удаление поста -->
          <form action="{{ url_for('delete_blog_post_admin', post_id=post.id) }}"
                method="POST"
                style="display:inline-block; margin:0; padding:0;"
                onsubmit="return confirm('Удалить статью {{ post.title }}?');">
            <button type="submit">Удалить</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
